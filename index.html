<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Upload Foto</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root { --ring: 59 130 246; }
    html, body { height: 100%; }
    body { font-family: Inter, ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, Noto Sans, "Apple Color Emoji", "Segoe UI Emoji"; }
    .dropzone.dragover { outline: 2px dashed rgb(59 130 246); background: rgb(239 246 255); }
  </style>
</head>
<body class="min-h-full bg-slate-50">
  <header class="sticky top-0 z-10 bg-white/80 backdrop-blur border-b border-slate-200">
    <div class="max-w-5xl mx-auto px-4 py-4 flex items-center justify-between">
      <h1 class="text-2xl font-semibold tracking-tight">üì∏ Upload Foto</h1>
      <div class="flex items-center gap-2 text-sm text-slate-600">
        <span>Status:</span>
        <span id="statusBadge" class="px-2 py-1 rounded-full bg-amber-100 text-amber-700">Mode Lokal</span>
      </div>
    </div>
  </header>

  <main class="max-w-5xl mx-auto px-4 py-8">
    <!-- Config -->
    <section class="mb-6">
      <details class="group">
        <summary class="cursor-pointer select-none flex items-center gap-2 text-slate-700 hover:text-slate-900">
          <span class="font-medium">Pengaturan (opsional)</span>
          <svg class="w-4 h-4 transition group-open:rotate-180" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M5.23 7.21a.75.75 0 011.06.02L10 11.17l3.71-3.94a.75.75 0 111.08 1.04l-4.25 4.5a.75.75 0 01-1.08 0l-4.25-4.5a.75.75 0 01.02-1.06z" clip-rule="evenodd"/></svg>
        </summary>
        <div class="mt-3 grid md:grid-cols-2 gap-4 bg-white rounded-2xl p-4 shadow-sm border">
          <label class="block">
            <span class="text-sm font-medium text-slate-700">Endpoint Server (kosongkan untuk mode lokal)</span>
            <input id="endpointInput" type="text" placeholder="contoh: /api/upload" class="mt-1 w-full rounded-xl border-slate-300 focus:ring-2 focus:ring-sky-500 focus:border-sky-500" />
          </label>
          <label class="block">
            <span class="text-sm font-medium text-slate-700">Maks. ukuran file (MB)</span>
            <input id="maxSizeInput" type="number" min="1" value="5" class="mt-1 w-full rounded-xl border-slate-300 focus:ring-2 focus:ring-sky-500 focus:border-sky-500" />
          </label>
        </div>
      </details>
    </section>

    <!-- Dropzone -->
    <section>
      <div id="dropzone" class="dropzone rounded-3xl border-2 border-dashed border-slate-300 bg-white p-8 text-center shadow-sm">
        <div class="mx-auto max-w-md">
          <div class="text-5xl mb-2">‚¨ÜÔ∏è</div>
          <h2 class="text-xl font-semibold">Tarik & letakkan foto di sini</h2>
          <p class="text-slate-600 mt-1">atau</p>
          <div class="mt-4">
            <label class="inline-flex items-center gap-2 px-4 py-2 rounded-2xl bg-sky-600 text-white hover:bg-sky-700 cursor-pointer">
              <input id="fileInput" type="file" accept="image/*" multiple class="hidden" />
              Pilih Foto
            </label>
          </div>
          <p class="text-xs text-slate-500 mt-3">Tipe didukung: JPG, PNG, GIF, WebP. Batas default 5MB per file.</p>
        </div>
      </div>
    </section>

    <!-- Actions -->
    <div class="mt-6 flex flex-wrap items-center gap-3">
      <button id="uploadBtn" class="px-4 py-2 rounded-2xl bg-emerald-600 text-white hover:bg-emerald-700 disabled:opacity-50" disabled>Upload</button>
      <button id="clearBtn" class="px-4 py-2 rounded-2xl bg-slate-200 text-slate-800 hover:bg-slate-300">Bersihkan</button>
      <div class="text-sm text-slate-600" id="summary"></div>
    </div>

    <!-- Gallery -->
    <section class="mt-6">
      <div id="gallery" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4"></div>
    </section>

    <!-- Footer note -->
    <footer class="mt-12 text-center text-xs text-slate-500">
      <p>Mode lokal menyimpan pratinjau di memori sementara browser (tidak diunggah). Isi "Endpoint Server" untuk mengirim ke server Anda via <code>multipart/form-data</code>.</p>
    </footer>
  </main>

  <template id="cardTemplate">
    <div class="card group rounded-2xl overflow-hidden border bg-white shadow-sm flex flex-col">
      <div class="relative w-full aspect-square bg-slate-100 flex items-center justify-center">
        <img class="preview max-w-full max-h-full object-contain" alt="preview" />
        <div class="progress absolute bottom-0 left-0 h-1 w-0 bg-sky-500 transition-all"></div>
      </div>
      <div class="p-3 flex-1 flex flex-col gap-2">
        <div class="text-sm font-medium name truncate"></div>
        <div class="text-xs text-slate-500 size"></div>
        <div class="text-xs mt-auto"><span class="status inline-flex items-center px-2 py-0.5 rounded-full bg-slate-100 text-slate-700">Menunggu</span></div>
        <div class="text-[11px] text-emerald-700 hidden success"></div>
        <div class="text-[11px] text-rose-700 hidden error"></div>
        <div class="flex gap-2 mt-2">
          <button class="remove px-2 py-1 rounded-lg bg-slate-100 hover:bg-slate-200 text-xs">Hapus</button>
          <a class="download hidden px-2 py-1 rounded-lg bg-sky-600 hover:bg-sky-700 text-white text-xs" download>Unduh</a>
        </div>
      </div>
    </div>
  </template>

  <script>
    // ====== Konfigurasi ======
    let UPLOAD_ENDPOINT = ""; // isi dengan '/api/upload' atau URL server Anda
    const state = { files: [], maxMB: 5 };

    const el = {
      dz: document.getElementById('dropzone'),
      input: document.getElementById('fileInput'),
      uploadBtn: document.getElementById('uploadBtn'),
      clearBtn: document.getElementById('clearBtn'),
      gallery: document.getElementById('gallery'),
      summary: document.getElementById('summary'),
      statusBadge: document.getElementById('statusBadge'),
      endpointInput: document.getElementById('endpointInput'),
      maxSizeInput: document.getElementById('maxSizeInput'),
      cardTmpl: document.getElementById('cardTemplate')
    };

    const fmtBytes = (b) => {
      const u = ['B','KB','MB','GB'];
      let i = 0; let n = b;
      while (n >= 1024 && i < u.length-1) { n /= 1024; i++; }
      return `${n.toFixed( (i===0)?0 : (n<10?2:1) )} ${u[i]}`;
    };

    function updateStatusBadge(){
      const isServer = !!UPLOAD_ENDPOINT;
      el.statusBadge.textContent = isServer ? 'Mode Server' : 'Mode Lokal';
      el.statusBadge.className = 'px-2 py-1 rounded-full ' + (isServer ? 'bg-emerald-100 text-emerald-700' : 'bg-amber-100 text-amber-700');
    }

    function setSummary(){
      if (!state.files.length) { el.summary.textContent = ''; return; }
      const total = state.files.reduce((a,f)=>a+f.file.size,0);
      el.summary.textContent = `${state.files.length} file dipilih ‚Ä¢ ${fmtBytes(total)}`;
      el.uploadBtn.disabled = state.files.length === 0;
    }

    function makeCard(file){
      const node = el.cardTmpl.content.firstElementChild.cloneNode(true);
      const img = node.querySelector('.preview');
      const name = node.querySelector('.name');
      const size = node.querySelector('.size');
      const status = node.querySelector('.status');
      const progress = node.querySelector('.progress');
      const err = node.querySelector('.error');
      const ok = node.querySelector('.success');
      const remove = node.querySelector('.remove');
      const download = node.querySelector('.download');

      name.textContent = file.name;
      size.textContent = fmtBytes(file.size);

      const url = URL.createObjectURL(file);
      img.src = url;
      download.href = url;
      download.download = file.name;
      download.classList.remove('hidden');

      remove.addEventListener('click', () => {
        const idx = state.files.findIndex(f => f.id === card.id);
        if (idx > -1) { state.files.splice(idx,1); }
        node.remove();
        setSummary();
      });

      const card = { id: crypto.randomUUID(), node, file, status, progress, err, ok };
      node.dataset.id = card.id;
      return card;
    }

    function addFiles(files){
      const maxBytes = state.maxMB * 1024 * 1024;
      [...files].forEach(f => {
        if (!f.type.startsWith('image/')) {
          toast(`File "${f.name}" bukan gambar`);
          return;
        }
        if (f.size > maxBytes){
          toast(`File "${f.name}" melebihi batas ${state.maxMB}MB`);
          return;
        }
        const card = makeCard(f);
        state.files.push(card);
        el.gallery.prepend(card.node);
      });
      setSummary();
    }

    function toast(msg){
      const t = document.createElement('div');
      t.textContent = msg;
      t.className = 'fixed bottom-6 left-1/2 -translate-x-1/2 bg-slate-900 text-white text-sm px-3 py-2 rounded-xl shadow-lg';
      document.body.appendChild(t);
      setTimeout(()=> t.remove(), 2200);
    }

    async function uploadAll(){
      if (!state.files.length) return;
      el.uploadBtn.disabled = true;
      try {
        for (const item of state.files){
          await uploadOne(item);
        }
      } finally {
        el.uploadBtn.disabled = false;
      }
    }

    async function uploadOne(item){
      item.err.classList.add('hidden');
      item.ok.classList.add('hidden');
      item.status.textContent = UPLOAD_ENDPOINT ? 'Mengunggah‚Ä¶' : 'Menyimpan (lokal)‚Ä¶';

      // Simulasi progress bar
      item.progress.style.transition = 'width .2s ease';
      let prog = 0; const timer = setInterval(()=>{
        prog = Math.min(95, prog + Math.random()*15);
        item.progress.style.width = prog + '%';
      }, 200);

      try {
        let resultText = '';
        if (UPLOAD_ENDPOINT){
          const fd = new FormData();
          fd.append('file', item.file, item.file.name);
          const res = await fetch(UPLOAD_ENDPOINT, { method: 'POST', body: fd });
          if (!res.ok) throw new Error('Gagal upload: ' + res.status);
          const ct = res.headers.get('content-type') || '';
          resultText = ct.includes('application/json') ? JSON.stringify(await res.json()) : await res.text();
        } else {
          // Mode lokal: tidak mengirim ke server, hanya pratinjau disimpan oleh browser.
          await new Promise(r => setTimeout(r, 600 + Math.random()*600));
          resultText = 'Disimpan lokal (tidak diunggah)';
        }
        clearInterval(timer);
        item.progress.style.width = '100%';
        item.status.textContent = 'Selesai';
        item.ok.textContent = resultText;
        item.ok.classList.remove('hidden');
      } catch (e){
        clearInterval(timer);
        item.status.textContent = 'Gagal';
        item.err.textContent = e.message;
        item.err.classList.remove('hidden');
      }
    }

    // ====== Event wiring ======
    el.input.addEventListener('change', (e)=> addFiles(e.target.files));

    ['dragenter','dragover'].forEach(evt => el.dz.addEventListener(evt, e=>{
      e.preventDefault(); e.stopPropagation();
      el.dz.classList.add('dragover');
    }));
    ;['dragleave','drop'].forEach(evt => el.dz.addEventListener(evt, e=>{
      e.preventDefault(); e.stopPropagation();
      if (evt==='drop') addFiles(e.dataTransfer.files);
      el.dz.classList.remove('dragover');
    }));

    el.uploadBtn.addEventListener('click', uploadAll);
    el.clearBtn.addEventListener('click', ()=>{
      state.files = [];
      el.gallery.innerHTML = '';
      setSummary();
    });

    el.endpointInput.addEventListener('input', (e)=>{
      UPLOAD_ENDPOINT = e.target.value.trim();
      updateStatusBadge();
    });

    el.maxSizeInput.addEventListener('input', (e)=>{
      const v = parseInt(e.target.value, 10);
      state.maxMB = isNaN(v) || v < 1 ? 5 : v;
    });

    // Init
    updateStatusBadge();
    setSummary();
  </script>

  <!--
  =====================
  Contoh backend Node/Express (opsional):
  =====================

  // 1) Instalasi:
  //    npm i express multer cors
  // 2) Simpan sebagai server.js lalu jalankan: node server.js

  const express = require('express');
  const multer = require('multer');
  const cors = require('cors');
  const path = require('path');
  const fs = require('fs');

  const app = express();
  app.use(cors());
  const upload = multer({ dest: path.join(__dirname, 'uploads') });

  app.post('/api/upload', upload.single('file'), (req, res) => {
    // Di sini Anda bisa memindahkan file ke storage permanen / cloud
    // atau mengembalikan URL.
    const info = {
      filename: req.file.originalname,
      mimetype: req.file.mimetype,
      size: req.file.size,
      storedAs: req.file.filename,
      url: '/uploads/' + req.file.filename
    };
    res.json(info);
  });

  app.use('/uploads', express.static(path.join(__dirname, 'uploads')));

  const PORT = process.env.PORT || 3000;
  app.listen(PORT, () => console.log('Server berjalan di http://localhost:'+PORT));

  // Setelah backend jalan, di halaman ini isi kolom "Endpoint Server" dengan
  //   http://localhost:3000/api/upload
  -->
</body>
</html>
